
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title>Usefulness of Duplicated Code Data</title>
    <meta name="description" content="">

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" href="../favicon.ico">

    <link rel="stylesheet" type="text/css" href="../assets/css/screen.css?v=96b7e3718a">
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,400">

    <link rel="canonical" href="http://www.objectcraftworks.com/usefulness-of-duplicate-code-data/">
    
    <meta property="og:site_name" content="Object Craftworks">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Usefulness of Duplicated Code Data">
    <meta property="og:description" content="Duplicated code, left unchecked, becomes a maintenance nightmare. Periodic code reviews can help keep tabs on duplicates. In addition to code reviews, duplicated code finding tools are useful to gather the data. We will cover in this post what we...">
    <meta property="og:url" content="http://www.objectcraftworks.com/usefulness-of-duplicate-code-data/">
    <meta property="og:image" content="http://www.objectcraftworks.com/content/images/2015/06/8812420553_913aea5b13_b-1.jpg">
    <meta property="article:published_time" content="2015-03-20T20:40:24.026Z">
    <meta property="article:modified_time" content="2015-06-13T02:21:31.988Z">
    <meta property="article:tag" content="Duplicate code">
    <meta property="article:tag" content="Design smell">
    <meta property="article:tag" content="Resharper dupFinder">
    <meta property="article:tag" content="NDepend Power Tools">
    <meta property="article:tag" content="Visual Studio Clone Code Detection">
    <meta property="article:tag" content="Iterating from the right place">
    
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Usefulness of Duplicated Code Data">
    <meta name="twitter:description" content="Duplicated code, left unchecked, becomes a maintenance nightmare. Periodic code reviews can help keep tabs on duplicates. In addition to code reviews, duplicated code finding tools are useful to gather the data. We will cover in this post what we...">
    <meta name="twitter:url" content="http://www.objectcraftworks.com/usefulness-of-duplicate-code-data/">
    <meta name="twitter:image:src" content="http://www.objectcraftworks.com/content/images/2015/06/8812420553_913aea5b13_b-1.jpg">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Object Craftworks",
    "author": {
        "@type": "Person",
        "name": "Prasad Narravula",
        "url": "http://www.objectcraftworks.com/author/prasad",
        "sameAs": null,
        "description": null
    },
    "headline": "Usefulness of Duplicated Code Data",
    "url": "http://www.objectcraftworks.com/usefulness-of-duplicate-code-data/",
    "datePublished": "2015-03-20T20:40:24.026Z",
    "dateModified": "2015-06-13T02:21:31.988Z",
    "image": "http://www.objectcraftworks.com/content/images/2015/06/8812420553_913aea5b13_b-1.jpg",
    "keywords": "Duplicate code, Design smell, Resharper dupFinder, NDepend Power Tools, Visual Studio Clone Code Detection, Iterating from the right place",
    "description": "Duplicated code, left unchecked, becomes a maintenance nightmare. Periodic code reviews can help keep tabs on duplicates. In addition to code reviews, duplicated code finding tools are useful to gather the data. We will cover in this post what we..."
}
    </script>

    <meta name="generator" content="Ghost 0.6">
    <link rel="alternate" type="application/rss+xml" title="Object Craftworks" href="http://www.objectcraftworks.com/rss/">
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42416416-1', 'auto');
  ga('send', 'pageview');

</script>
</head>
<body class="post-template tag-duplicate-code tag-design-smell tag-resharper-dupfinder tag-ndepend-power-tools tag-visual-studio-clone-code-detection tag-iterating-from-the-right-place nav-closed">

    <div class="nav">
    <h3 class="nav-title">Menu</h3>
    <a href="index.html#" class="nav-close">
        <span class="hidden">Close</span>
    </a>
    <ul>
            <li class="nav-home" role="presentation"><a href="http://www.objectcraftworks.com/">Home</a></li>
    </ul>
    <a class="subscribe-button icon-feed" href="http://www.objectcraftworks.com/rss/">Subscribe</a>
</div>
<span class="nav-cover"></span>

    <div class="site-wrapper">
        


<header class="main-header post-head " style="background-image: url(../content/images/2015/06/8812420553_913aea5b13_b-1.jpg)">
    <nav class="main-nav overlay clearfix">
        
            <a class="menu-button icon-menu" href="index.html#"><span class="word">Menu</span></a>
    </nav>
</header>

<main class="content" role="main">

    <article class="post tag-duplicate-code tag-design-smell tag-resharper-dupfinder tag-ndepend-power-tools tag-visual-studio-clone-code-detection tag-iterating-from-the-right-place">

        <header class="post-header">
            <h1 class="post-title">Usefulness of Duplicated Code Data</h1>
            <section class="post-meta">
                <time class="post-date" datetime="2015-03-20">20 March 2015</time>  on <a href="../tag/duplicate-code/">Duplicate code</a>, <a href="../tag/design-smell/">Design smell</a>, <a href="../tag/resharper-dupfinder/">Resharper dupFinder</a>, <a href="../tag/ndepend-power-tools/">NDepend Power Tools</a>, <a href="../tag/visual-studio-clone-code-detection/">Visual Studio Clone Code Detection</a>, <a href="../tag/iterating-from-the-right-place/">Iterating from the right place</a>
		<a href="index.html#disqus_thread">Comments</a>
            </section>
        </header>

        <section class="post-content">
            <p>Duplicated code, left unchecked, becomes a maintenance nightmare. Periodic code reviews can help keep tabs on duplicates. In addition to code reviews, duplicated code finding tools are useful to gather the data. We will cover in this post what we can gain from this data, and the tools to collect it.</p>

<h3 id="duplicatesarethesymptoms">Duplicates are the symptoms</h3>

<p>It may be economical to reuse a piece of working code, but not by making copies. These copies, if designed properly, can find their place in the family of objects. Kent Beck writes in his <a href="http://www.amazon.com/Test-Driven-Development-By-Example/dp/0321146530">TDD by Example book</a> that the duplication is the symptom of the dependency. Sure, the design patterns give us the language to discover these participating objects, and their collaborations. Unless the team has the right skill level and looks rigorously for the duplicates, they pile up and age the system. For experienced or just starting, the data can act as a feedback loop in finding the missing collaborators.</p>

<h3 id="considerthecontext">Consider the Context</h3>

<p>But all copies are not duplicates. We need to consider their contexts. It may not be as simple as creating a static utility class to house a snippet for the reuse. This approach mostly comes in the way by obscuring the abstractions. But this delegation approach is better than moving the code to base classes bloating the hierarchy with unrelated responsibilities. Beware of the cost associated with the reuse that spans across the teams.</p>

<h3 id="slowdowntodesign">Slow down to Design</h3>

<p>As duplication is a design smell, it is time to think and design. It is hard to slow down under the typical schedule pressure. But it is worth the time, any effort in this matter will pay back and improve your crafting skills.</p>

<p>For TDD practitioners, removing duplication is a disciplined effort. TDD cycles, Red/Green/Refactor, allow you to take the time to think and make strategic design decisions.</p>

<p>The best way to find the duplicates as you are writing the code is cultivating the habit of looking for them. It is better to do after getting the tests pass i.e. in the green state. If you are not doing TDD, then you could do after your code gets OK’d by the some form of testing before calling the story done.</p>

<h3 id="toolstogetthedata">Tools to get the data</h3>

<p>When the team has not yet thoroughly adapted the TDD practice, or is working with a legacy codebase, or managing entire codebase, duplicate finders are handy.</p>

<p>There are three duplicate finders <a href="https://msdn.microsoft.com/en-us/library/hh205279.aspx">Visual Studio code clone detection</a>, <a href="https://confluence.jetbrains.com/display/NETCOM/Introducing+ReSharper+Command+Line+Tools">dupFinder from Resharper</a>, and <a href="http://www.ndepend.com/features/api-and-tools">Power Tools from NDepend</a>. We will cover last two tools. The Visual Studio's feature is available only in the ultimate and premium editions. Finding the duplicate code is not an exact science. These tools bring the possible candidates to the forefront, and you need to identify potential duplicates.</p>

<p>Let’s take a class Foo with two duplicate methods, Bar and Copied Bar, that create an address object from a customer.</p>

<pre><code class="language-csharp    ">class Foo  
{
    Address Bar(Customer customer)  
    Address CopiedBar(Customer customer) 
       //Exact copy of Bar
}
</code></pre>

<h4 id="resharpersdupfinder">Resharper's dupFinder</h4>

<p>Let’s start with Resharper’s dupFinder:</p>

<p>You can download the command line tools from <a href="https://confluence.jetbrains.com/display/NETCOM/Introducing+ReSharper+Command+Line+Tools">here</a>. Check out JetBrains’ <a href="https://confluence.jetbrains.com/display/NETCOM/Introducing+dupFinder">blog post</a> for the command line parameters.</p>

<p>You can run the command line or use my <a href="https://github.com/objectcraftworks/.net-dev-tools/tree/master/DuplicateCodeFinders/Resharper">PowerShell script</a>  that runs the command, and  transforms the output XML to HTML (using XSL stylesheet which is in the same folder). Here is the report: <br>
<img src="../content/images/2015/06/duplicate_1.png" alt="Report with two clones"></p>

<p>You can control the matching by using <code>discard-XXX</code> parameters. <br>
For example, <code>/discard-literal=true</code> argument will bring following as duplicates discarding the values while matching.</p>

<pre><code>address.StreetAddress ="1 Way"
address.StreetAddress ="Other way"
</code></pre>

<p>But it has limitations in matching the copies. Let’s add another copy of the <code>Bar</code>, but with a twist. This time, we will use object initializer syntax.</p>

<pre><code class="language-csharp">public Address BarWithObjectInitializer(Customer customer)  
{
   return new Address
   {
        StreetAddress = customer.StreetAddress,
        SuiteOrAptNo = customer.SuitOrAptNo,
        City = customer.City,
        State = customer.State,
        Zip = customer.Zip
   };
}
</code></pre>

<p>Instead of three fragments, it matches only two as seen in the following report.</p>

<p><img src="../content/images/2015/06/Screen-Shot-2015-03-20-at-4-46-38-PM.png" alt="Just two segments"></p>

<h4 id="ndependspowertools">NDepend's Power Tools</h4>

<p>Let’s look at the other tool, NDepend's Power Tools. These tools are based on NDepend API, and are open sourced. Let’s run their duplicate finder on our sample. It brings all the three methods (as seen in the screenshot below) as duplicates. <br>
<img src="../content/images/2015/06/Screen-Shot-2015-03-20-at-5-32-26-PM.png" alt="NDepend result screenshot">
If you are interested to know how it determines the clones, you can read a <a href="http://codebetter.com/patricksmacchia/2012/06/12/an-original-algorithm-to-find-net-code-duplicate/">post</a> by <a href="http://codebetter.com/patricksmacchia/author/patricksmacchia/">Patrick Smacchia</a> of NDepend team.</p>

<p>The team can share reports the dupFinder generates. Depending on your team coding styles, you might miss some potential candidates. The plugin itself is good, and can improve your productivity. I imagine most of the developers using it these days. You can watch my <a href="http://www.objectcraftworks.com/screencast-testfirst-tdd-overview/">TDD overview screencast</a> for its use in TDD cycles. </p>

<p>As NDepend works on the IL code, it is hard to miss any clones. As a static code analysis tool, NDepend offers a <a href="http://www.ndepend.com/features/">rich feature set</a> to manage the code. With this tool, you can query the codebase using its LINQ like query capabilities. For example, you can write a query to answer this question,  <em>Is there any class that has fields of IDisposable type, but not implementing IDisposable?</em>.</p>

<p>I like to see the features such as finding duplicates in a given namespace or between namespaces, and  IDE integration.</p>

<p>Both plugins offer trail version.</p>

<h4 id="keypointscovered">Key points covered:</h4>

<ul>
<li>Use tools to find the code duplicates.</li>
<li>Consider the context.</li>
<li>Use the data of duplicated code to discover missing dependencies. </li>
</ul>

<p><em>Attribution: Thanks to <a href="https://www.flickr.com/photos/archetypefotografie/">Vincent_AF</a> for the pattern image.</em></p>
      
        </section>
      
   <footer class="post-footer">


            <section class="author">
                       
    <h4><a href="../author/prasad/">Prasad Narravula</a></h4>

                    <p>Read <a href="../author/prasad/">more posts</a> by this author.</p>
                               <div class="author-meta">
                    
                    
                </div>
                 <p class="alert alert-info" style="background:#d9edf7;color:#31708f;border-color:#bce8f1;padding:2px"><a href="http://eepurl.com/bhBYj1">Subscribe</a> to our mailing list for updates.</p>


			</section>


            <section class="share">
                <h4>Share this post</h4>
                <a class="icon-twitter" href="https://twitter.com/share?text=Usefulness%20of%20Duplicated%20Code%20Data&amp;url=http://www.objectcraftworks.com/usefulness-of-duplicate-code-data/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <span class="hidden">Twitter</span>
                </a>
                <a class="icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://www.objectcraftworks.com/usefulness-of-duplicate-code-data/" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <span class="hidden">Facebook</span>
                </a>
                <a class="icon-google-plus" href="https://plus.google.com/share?url=http://www.objectcraftworks.com/usefulness-of-duplicate-code-data/" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <span class="hidden">Google+</span>
                </a>
            </section>
        </footer>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'objectcraftworkscom';

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </article>

</main>

<aside class="read-next">
    <a class="read-next-story " style="background-image: url(../content/images/2015/07/4136079364_bb2bb30935_o.jpg)" href="../towards-better-code-reviews.1">
        <section class="post">
            <h2>Iterate towards better Code Reviews</h2>
            <p>When code review meetings derail from the purpose, they become painful and unproductive. We will cover in this post…</p>
        </section>
    </a>
    <a class="read-next-story prev " style="background-image: url(../content/images/2015/03/4026467075_c632b10034_z-1.jpg)" href="../screencast-testfirst-tdd-overview.1">
        <section class="post">
            <h2>Watch Code Taking Shape with TDD</h2>
            <p>In this screencast, we will cover the process of the test first Test Driven Development (TDD). TDD is one…</p>
        </section>
    </a>
</aside>


        <footer class="site-footer clearfix">
            <section class="copyright"><a href="http://www.objectcraftworks.com">Object Craftworks</a> © 2015</section>
            <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
        </footer>

    </div>

    <script src="../public/jquery.js?v=96b7e3718a"></script>

    <script type="text/javascript" src="../assets/js/jquery.fitvids.js?v=96b7e3718a"></script>
    <script type="text/javascript" src="../assets/js/index.js?v=96b7e3718a"></script>
    <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname = 'objectcraftworkscom';
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
